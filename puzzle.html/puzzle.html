<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>3x3 スライドパズル</title>
<style>
body {
font-family: Arial, sans-serif;
text-align: center;
}
#thumbnail-container {
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 10px;
margin-top: 10px;
}
.thumb {
width: 80px;
height: 80px;
object-fit: cover;
border: 2px solid #333;
cursor: pointer;
transition: transform 0.2s;
}
.thumb:hover {
transform: scale(1.1);
border-color: red;
}
#game-area {
display: flex;
justify-content: center;
align-items: flex-start;
gap: 20px; /* パズルと完成図の間隔を広めに */
margin-top: 20px;
}
#puzzle {
display: grid;
grid-template-columns: repeat(3, 100px);
grid-template-rows: repeat(3, 100px);
gap: 2px;
width: 306px;
height: 306px;
border: 2px solid #333;
margin: 0 auto; /* 中央寄せ */
}
.tile {
background-size: 300px 300px;
cursor: pointer;
}
.empty {
background: #eee;
}
#goal-container {
text-align: center;
}
#goal {
width: 200px;
height: 200px;
border: 2px solid #333;
background-size: cover;
background-position: center;
margin: 0 auto;
}
#timer {
font-size: 20px;
margin-top: 10px;
}
#ranking {
margin-top: 20px;
}
</style>
</head>
<body>
<h1>3×3 スライドパズル</h1>

<p>好きな画像をクリックしてゲームを始めてください</p>
<div id="thumbnail-container">
<img src="images/img1.jpg" class="thumb" onclick="selectImage('images/img1.jpg')">
<img src="images/img2.jpg" class="thumb" onclick="selectImage('images/img2.jpg')">
<img src="images/img3.jpg" class="thumb" onclick="selectImage('images/img3.jpg')">
<img src="images/img4.jpg" class="thumb" onclick="selectImage('images/img4.jpg')">
<img src="images/img5.jpg" class="thumb" onclick="selectImage('images/img5.jpg')">
<img src="images/img6.jpg" class="thumb" onclick="selectImage('images/img6.jpg')">
<img src="images/img7.jpg" class="thumb" onclick="selectImage('images/img7.jpg')">
<img src="images/img8.jpg" class="thumb" onclick="selectImage('images/img8.jpg')">
<img src="images/img9.jpg" class="thumb" onclick="selectImage('images/img9.jpg')">
<img src="images/img10.jpg" class="thumb" onclick="selectImage('images/img10.jpg')">
</div>

<div id="timer">経過時間: 0 秒</div>

<div id="game-area">
<div id="puzzle"></div>
<div id="goal-container">
<p>完成図</p>
<div id="goal"></div>
</div>
</div>

<h2>ランキング（上位5人）</h2>
<ol id="ranking"></ol>

<script>
const puzzle = document.getElementById("puzzle");
const timerDisplay = document.getElementById("timer");
const rankingList = document.getElementById("ranking");
const goal = document.getElementById("goal");

let tiles = [];
let emptyIndex = 8;
let timer = null;
let seconds = 0;
let imageURL = "";
let ranking = JSON.parse(localStorage.getItem("ranking") || "[]");
let gameStarted = false;

function selectImage(path) {
imageURL = path;
initPuzzle();
goal.style.backgroundImage = `url(${imageURL})`;
resetTimer();
gameStarted = false;
}

function initPuzzle() {
puzzle.innerHTML = "";
tiles = [...Array(8).keys()];
shuffle(tiles);
tiles.push(null);

tiles.forEach((tile, i) => {
const div = document.createElement("div");
div.classList.add("tile");
if (tile === null) {
div.classList.add("empty");
emptyIndex = i;
} else {
const x = tile % 3;
const y = Math.floor(tile / 3);
div.style.backgroundImage = `url(${imageURL})`;
div.style.backgroundPosition = `-${x * 100}px -${y * 100}px`;
}
div.addEventListener("click", () => moveTile(i));
puzzle.appendChild(div);
});
}

function shuffle(array) {
for (let i = array.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[array[i], array[j]] = [array[j], array[i]];
}
}

function moveTile(index) {
const neighbors = [emptyIndex - 1, emptyIndex + 1, emptyIndex - 3, emptyIndex + 3];
if (!neighbors.includes(index)) return;

if (!gameStarted) {
startTimer();
gameStarted = true;
}

[tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
emptyIndex = index;
renderPuzzle();

if (checkClear()) {
stopTimer();
setTimeout(() => {
const name = prompt("クリア！名前を入力してください:");
if (name) {
ranking.push({ name, time: seconds });
ranking.sort((a, b) => a.time - b.time);
ranking = ranking.slice(0, 5);
localStorage.setItem("ranking", JSON.stringify(ranking));
updateRanking();
}
}, 100);
}
}

function renderPuzzle() {
Array.from(puzzle.children).forEach((div, i) => {
const tile = tiles[i];
div.className = "tile";
if (tile === null) {
div.classList.add("empty");
div.style.backgroundImage = "";
} else {
const x = tile % 3;
const y = Math.floor(tile / 3);
div.style.backgroundImage = `url(${imageURL})`;
div.style.backgroundPosition = `-${x * 100}px -${y * 100}px`;
}
});
}

function checkClear() {
for (let i = 0; i < 8; i++) {
if (tiles[i] !== i) return false;
}
return true;
}

function startTimer() {
stopTimer();
timer = setInterval(() => {
seconds++;
timerDisplay.textContent = `経過時間: ${seconds} 秒`;
}, 1000);
}

function stopTimer() {
clearInterval(timer);
timer = null;
}

function resetTimer() {
stopTimer();
seconds = 0;
timerDisplay.textContent = `経過時間: 0 秒`;
}

function updateRanking() {
rankingList.innerHTML = "";
ranking.forEach(r => {
const li = document.createElement("li");
li.textContent = `${r.name} - ${r.time} 秒`;
rankingList.appendChild(li);
});
}

updateRanking();
</script>
</body>
</html>